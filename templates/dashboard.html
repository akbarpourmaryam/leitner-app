
{% extends "base.html" %}
{% block content %}

{% if review_cards %}
<div class="card" style="background: linear-gradient(135deg, #fef3c7 0%, #fcd34d 100%); border-left: 4px solid #f59e0b;">
  <h2>üéØ Review Session - {{ review_cards|length }} Problem(s) Due Today!</h2>
  <p style="margin-bottom: 24px;">Review these problems to keep them fresh in your memory.</p>
  
  <table>
    <thead>
      <tr>
        <th>Problem</th>
        <th>Note</th>
        <th>Current Box</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for c in review_cards %}
      <tr>
        <td>
          <a href="{{c.link}}" target="_blank" class="problem-link">{{ c.title }}</a>
        </td>
        <td class="muted">{{ c.idea[:60] + '...' if c.idea and c.idea|length > 60 else (c.idea or "") }}</td>
        <td><span class="badge badge-primary">Box {{ c.leitner_box }}</span></td>
        <td>
          <form class="inline" method="post" action="{{ url_for('mark', card_id=c.id, result='fail') }}" style="margin-right:8px;">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <button class="btn btn-danger btn-sm">‚ùå Again</button>
          </form>
          <form class="inline" method="post" action="{{ url_for('mark', card_id=c.id, result='pass') }}">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <button class="btn btn-success btn-sm">‚úì Pass</button>
          </form>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endif %}

<div class="card">
  <h2>üìä Dashboard</h2>
  <div>
    <span class="stat">Total<strong>{{ total }}</strong></span>
    <span class="stat">Due Today<strong>{{ due_today }}</strong></span>
    <span class="stat">
      {% for b in [1,2,3,4,5] %}
        Box {{b}}: <strong style="display:inline;">{{ box_counts.get(b,0) }}</strong>{% if not loop.last %} ¬∑ {% endif %}
      {% endfor %}
    </span>
  </div>
</div>

<div class="card">
  <form method="get" action="{{ url_for('dashboard') }}">
    <input type="text" name="q" value="{{q}}" placeholder="üîç Search by title or notes...">
  </form>
</div>

<div class="card">
  <h3>‚ûï Add a New Problem</h3>
  <form method="post" action="{{ url_for('add') }}">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
    
    <div class="form-group">
      <label>LeetCode Problem URL</label>
      <input type="url" name="link" id="leetcode-url" placeholder="https://leetcode.com/problems/two-sum/" required>
      <small class="muted">Paste the LeetCode URL - we'll try to fetch the title automatically!</small>
    </div>
    
    <div class="form-group">
      <label>Problem Title (Optional - only if auto-fetch fails)</label>
      <input type="text" name="title" id="problem-title" placeholder="e.g., 1. Two Sum">
      <small class="muted">If we can't fetch the title, enter it manually here</small>
    </div>
    
    <div class="form-group">
      <label>Note (Optional)</label>
      <textarea name="note" placeholder="Key insights, patterns, or approach you used..."></textarea>
    </div>
    
    <div class="form-group">
      <label>Starting Leitner Box</label>
      <select name="leitner_box">
        {% for b in [1,2,3,4,5] %}
        <option value="{{b}}" {% if b == 1 %}selected{% endif %}>Box {{b}} ({{ [1,3,7,14,30][b-1] }} days)</option>
        {% endfor %}
      </select>
    </div>
    
    <div class="right">
      <button class="btn">Add Problem</button>
    </div>
  </form>
</div>

<div class="card">
  <h3>üìù Your Problems</h3>
  {% if cards %}
  <table>
    <thead>
      <tr>
        <th>Problem</th>
        <th>Note</th>
        <th>Box</th>
        <th>Practiced On</th>
        <th>Next Review</th>
        <th></th>
      </tr>
    </thead>
    <tbody>
      {% for c in cards %}
      <tr>
        <td>
          <a href="{{c.link}}" target="_blank" class="problem-link">{{ c.title }}</a>
        </td>
        <td class="muted">{{ c.idea[:80] + '...' if c.idea and c.idea|length > 80 else (c.idea or "") }}</td>
        <td><span class="badge badge-primary">Box {{ c.leitner_box }}</span></td>
        <td class="muted">{{ c.solved_date }}</td>
        <td class="muted">{{ c.next_review }}</td>
        <td class="right">
          <a href="{{ url_for('edit', card_id=c.id) }}" class="btn btn-outline btn-sm" style="text-decoration:none;display:inline-block;margin-right:8px;">Edit</a>
          <form class="inline" method="post" action="{{ url_for('delete', card_id=c.id) }}" onsubmit="return confirm('Delete this problem?')">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <button class="btn btn-danger btn-sm">Delete</button>
          </form>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% else %}
  <div class="empty-state">
    <h3>No problems yet!</h3>
    <p>Add your first LeetCode problem above to get started.</p>
  </div>
  {% endif %}
</div>
{% endblock %}

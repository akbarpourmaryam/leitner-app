
{% extends "base.html" %}
{% block content %}

{% if highlighted_card %}
<div class="card" style="background: linear-gradient(135deg, #fef3c7 0%, #fcd34d 100%); border-left: 4px solid #f59e0b;">
  <h2>‚ö†Ô∏è Duplicate Problem Detected</h2>
  <p style="margin-bottom: 20px;">This problem is already in your collection:</p>
  
  <div style="background: white; border-radius: 12px; padding: 20px; border: 2px solid #f59e0b;">
    <div style="margin-bottom: 12px;">
      <strong style="font-size: 18px;">
        <a href="{{ highlighted_card.link }}" target="_blank" class="problem-link">{{ highlighted_card.title }}</a>
      </strong>
    </div>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-top: 16px;">
      <div>
        <span class="muted" style="font-size: 13px;">Current Box:</span><br>
        <span class="badge badge-primary" style="font-size: 14px; margin-top: 4px;">Box {{ highlighted_card.leitner_box }}</span>
      </div>
      <div>
        <span class="muted" style="font-size: 13px;">Practiced On:</span><br>
        <strong>{{ highlighted_card.solved_date }}</strong>
      </div>
      <div>
        <span class="muted" style="font-size: 13px;">Next Review:</span><br>
        <strong>{{ highlighted_card.next_review }}</strong>
      </div>
    </div>
    {% if highlighted_card.idea %}
    <div style="margin-top: 16px; padding-top: 16px; border-top: 1px solid #eee;">
      <span class="muted" style="font-size: 13px;">Your Notes:</span><br>
      <p style="margin-top: 8px; color: #4b5563;">{{ highlighted_card.idea }}</p>
    </div>
    {% endif %}
    <div style="margin-top: 16px; text-align: center;">
      <a href="{{ url_for('edit', card_id=highlighted_card.id) }}" class="btn btn-outline" style="text-decoration: none; display: inline-block;">
        Edit This Problem
      </a>
    </div>
  </div>
  <p style="margin-top: 16px; color: #92400e; font-size: 14px;">
    üí° <strong>Tip:</strong> The problem is highlighted in yellow in your problems list below.
  </p>
</div>
{% endif %}

<div class="card" style="{% if review_cards %}background: linear-gradient(135deg, #fef3c7 0%, #fcd34d 100%); border-left: 4px solid #f59e0b;{% else %}background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%); border-left: 4px solid #10b981;{% endif %}">
  <h2>üéØ Review Session</h2>
  
  {% if review_cards %}
    <p style="margin-bottom: 24px;">You have <strong>{{ review_cards|length }}</strong> problem(s) due for review today!</p>
    
    <table>
      <thead>
        <tr>
          <th>Problem</th>
          <th>Note</th>
          <th>Current Box</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for c in review_cards %}
        <tr>
          <td>
            <a href="{{c.link}}" target="_blank" class="problem-link">{{ c.title }}</a>
          </td>
          <td class="muted">{{ c.idea[:60] + '...' if c.idea and c.idea|length > 60 else (c.idea or "") }}</td>
          <td><span class="badge badge-primary">Box {{ c.leitner_box }}</span></td>
          <td>
            <form class="inline" method="post" action="{{ url_for('mark', card_id=c.id, result='fail') }}" style="margin-right:8px;">
              <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
              <button class="btn btn-danger btn-sm">‚ùå Again</button>
            </form>
            <form class="inline" method="post" action="{{ url_for('mark', card_id=c.id, result='pass') }}">
              <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
              <button class="btn btn-success btn-sm">‚úì Pass</button>
            </form>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  {% else %}
    <div class="empty-state" style="padding: 40px 20px;">
      <h3 style="color: #059669;">üéâ All caught up!</h3>
      <p style="color: #6b7280;">No problems due for review today. Great job staying on top of your practice!</p>
      <p style="color: #9ca3af; font-size: 14px; margin-top: 12px;">
        Check back tomorrow or add more problems below.
      </p>
    </div>
  {% endif %}
</div>

<div class="card">
  <h2>üìä Dashboard</h2>
  <div>
    <span class="stat">Total<strong>{{ total }}</strong></span>
    <span class="stat">Due Today<strong>{{ due_today }}</strong></span>
    <span class="stat">
      {% for b in [1,2,3,4,5] %}
        Box {{b}}: <strong style="display:inline;">{{ box_counts.get(b,0) }}</strong>{% if not loop.last %} ¬∑ {% endif %}
      {% endfor %}
    </span>
  </div>
</div>

<div class="card">
  <form method="get" action="{{ url_for('dashboard') }}">
    <input type="text" name="q" value="{{q}}" placeholder="üîç Search by title or notes...">
  </form>
</div>

<div class="card">
  <h3>‚ûï Add a New Problem</h3>
  <form method="post" action="{{ url_for('add') }}">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
    
    <div class="form-group">
      <label>LeetCode Problem URL</label>
      <input type="url" name="link" id="leetcode-url" placeholder="https://leetcode.com/problems/two-sum/" required>
      <small class="muted">Paste the LeetCode URL - title will be fetched automatically!</small>
    </div>
    
    <div class="form-group">
      <label>Note (Optional)</label>
      <textarea name="note" placeholder="Key insights, patterns, or approach you used..."></textarea>
    </div>
    
    <div class="form-group">
      <label>Starting Leitner Box</label>
      <select name="leitner_box">
        {% for b in [1,2,3,4,5] %}
        <option value="{{b}}" {% if b == 1 %}selected{% endif %}>Box {{b}} ({{ [1,3,7,14,30][b-1] }} days)</option>
        {% endfor %}
      </select>
    </div>
    
    <div class="right">
      <button class="btn">Add Problem</button>
    </div>
  </form>
</div>

<div class="card">
  <h3>üìù Your Problems</h3>
  {% if cards %}
  <table>
    <thead>
      <tr>
        <th>Problem</th>
        <th>Note</th>
        <th>Box</th>
        <th>Practiced On</th>
        <th>Next Review</th>
        <th></th>
      </tr>
    </thead>
    <tbody>
      {% for c in cards %}
      <tr id="card-{{ c.id }}" {% if highlight_id and c.id == highlight_id %}style="background: linear-gradient(135deg, #fef3c7 0%, #fcd34d 100%); animation: highlight-pulse 2s ease-in-out;"{% endif %}>
        <td>
          <a href="{{c.link}}" target="_blank" class="problem-link">{{ c.title }}</a>
        </td>
        <td class="muted">{{ c.idea[:80] + '...' if c.idea and c.idea|length > 80 else (c.idea or "") }}</td>
        <td><span class="badge badge-primary">Box {{ c.leitner_box }}</span></td>
        <td class="muted">{{ c.solved_date }}</td>
        <td class="muted">{{ c.next_review }}</td>
        <td class="right">
          <a href="{{ url_for('edit', card_id=c.id) }}" class="btn btn-outline btn-sm" style="text-decoration:none;display:inline-block;margin-right:8px;">Edit</a>
          <form class="inline" method="post" action="{{ url_for('delete', card_id=c.id) }}" onsubmit="return confirm('Delete this problem?')">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <button class="btn btn-danger btn-sm">Delete</button>
          </form>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% else %}
  <div class="empty-state">
    <h3>No problems yet!</h3>
    <p>Add your first LeetCode problem above to get started.</p>
  </div>
  {% endif %}
</div>

{% if highlight_id %}
<style>
  @keyframes highlight-pulse {
    0%, 100% { background: linear-gradient(135deg, #fef3c7 0%, #fcd34d 100%); }
    50% { background: linear-gradient(135deg, #fde68a 0%, #fbbf24 100%); }
  }
</style>
<script>
  // Scroll to highlighted card
  document.addEventListener('DOMContentLoaded', function() {
    const highlightedCard = document.getElementById('card-{{ highlight_id }}');
    if (highlightedCard) {
      setTimeout(function() {
        highlightedCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
      }, 500);
    }
  });
</script>
{% endif %}
{% endblock %}
